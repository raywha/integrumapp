<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="tabs/tab1"  (click)="goBackView()" text="" color="dark"></ion-back-button>
    </ion-buttons>
    <ion-title style="font-size:16px">
      <!-- <ion-text *ngIf="status" style="position:relative;left:26px;top:-8px;">{{title}}</ion-text>
      <ion-text *ngIf="!status">{{title}}</ion-text>
      <ion-text style="position: relative;right: 66px;top:10px;">{{status}}</ion-text> -->
      <div class="htitle">{{title}}<br/>{{status}}</div>
      
    </ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="presentPopover($event)">
        <ion-icon style="color:#000;" name="menu"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div *ngIf="enableTemplateInfo=='ka_Yes'">
    <ion-item lines="none">
      <!-- <ion-label color="light">{{templateInfoLabel}}&nbsp;&nbsp;&nbsp;&nbsp;</ion-label>
      <ion-icon slot="end" color="light" name="arrow-forward" mode="ios" (click)="isShowGuidance(null,0)"
        *ngIf="!(list&&list[0]&&list[0].show)"></ion-icon>
      <ion-icon slot="end" color="light" name="arrow-down" mode="ios" (click)="isShowGuidance(null,0)"
        *ngIf="list[0].show">
      </ion-icon> -->
      <ion-icon name="information-circle-outline" color="success"></ion-icon>
      <ion-label (click)="openGuidance(templateInfoLabel,templateInfo)">{{templateInfoLabel}}&nbsp;&nbsp;&nbsp;&nbsp;</ion-label>
    </ion-item>
  
    <!-- <div *ngIf="list[0].show" class="guidance-box">
      <div [innerHTML]="sanitizer.bypassSecurityTrustHtml(templateInfo)"></div>
    </div> -->
  </div>
  <div class="form-container" id="edit" *ngIf="type=='edit'">

    <div *ngFor="let field of sysfields;let index = index;">
      <!--date-->
      <div *ngIf="!field.xtype" [hidden]="field.hide">
        <ion-item lines="none">
          <ion-label color="basic" stacked>{{field.label}}</ion-label>
        </ion-item>
        <ion-item>
          <ion-text [ngStyle]="{'color': cbgcolor}">
            {{field.value?field.value:initiator}}
          </ion-text>
        </ion-item>
      </div>
      <div *ngIf="field.xtype=='singleempselect'" [hidden]="field.hide">
        <ion-item>
          <ion-label color="basic" stacked>{{field.label}}
            <span *ngIf="field.mandatory=='Y'" class="needfill">*</span>
          </ion-label>
          <ion-icon *ngIf="field.name=='formRoleMR'" slot="end" name="arrow-forward" mode="ios" (click)="getRole(field.name,field.value,'single',field.label,field.rolelistlimitedto)">
          </ion-icon>
          <ion-icon *ngIf="field.name=='formMR'" slot="end" name="arrow-forward" mode="ios" (click)="getSecurity(field,'single')">
          </ion-icon>
        </ion-item>
        <ion-item>
          <ion-text *ngIf="field.name=='formRoleMR'" (click)="getPeopleByRole(field.value)" [ngStyle]="{'color': cbgcolor}">
            {{field.value}}
          </ion-text>
          <ion-icon *ngIf="field.name=='formRoleMR'" (click)="getPeopleByRole(field.value)" slot="end" name="help-circle-outline"></ion-icon>
          <ion-text *ngIf="field.name=='formMR'" [ngStyle]="{'color': cbgcolor}">
            {{field.value}}
          </ion-text>
        </ion-item>
      </div>
      <div *ngIf="field.xtype=='select'" [hidden]="field.hide">
        <ion-item>
          <ion-label  color="basic" stacked>{{field.label}}
            <span *ngIf="field.mandatory=='Y'" class="needfill">*</span>
          </ion-label>
          <ion-icon slot="end" name="arrow-forward" mode="ios"  (click)="getMrByTemplate(field.name,field.value,'single',field.label,field.options)">
          </ion-icon>
        </ion-item>
        <ion-item>
          <ion-text [ngStyle]="{'color': cbgcolor}">
            {{field.value}}
          </ion-text>
        </ion-item>
      </div>
      <!--date-->
      <div *ngIf="field.xtype=='date'" [hidden]="field.hide">
        <ion-item lines="none">
          <ion-label color="basic" stacked>{{field.label}}
            <span *ngIf="field.mandatory=='Y'" class="needfill">*</span>
          </ion-label>
        </ion-item>
        <ion-item>
          <div *ngIf="field.daterange=='all'">
            <ion-datetime displayFormat="DD/MM/YYYY" [max]="maxYear" [(ngModel)]='field.value'
            [placeholder]="field.placeholder?field.placeholder:''" color="favorite" [ngStyle]="{'color':cbgcolor}"></ion-datetime>
          </div>
          <div *ngIf="field.daterange=='future'">
            <ion-datetime displayFormat="DD/MM/YYYY" [min]="curDate" [max]="maxYear" [(ngModel)]='field.value'
            [placeholder]="field.placeholder?field.placeholder:''" color="favorite" [ngStyle]="{'color':cbgcolor}"></ion-datetime>
          </div>
          <div *ngIf="field.daterange=='past'">
            <ion-datetime displayFormat="DD/MM/YYYY" [max]="curDate" [(ngModel)]='field.value'
            [placeholder]="field.placeholder?field.placeholder:''" color="favorite" [ngStyle]="{'color':cbgcolor}"></ion-datetime>
          </div>
            <ion-icon slot="end" name="calendar" mode="md"></ion-icon>
        </ion-item>
      </div>
    </div>


    <div *ngFor="let section of sections;let index = index;" class="field-container" [id]="section.secId">
      <div *ngIf="index>0">
        
        <ion-item lines="none"  #testdom>
          <ion-label color="light">{{section.title}}&nbsp;&nbsp;&nbsp;&nbsp;{{section.score}}</ion-label>
          <ion-icon slot="end" color="light" name="arrow-forward" mode="ios"
            (click)="isShowGuidance(section,index)" *ngIf="!(list&&list[index]&&list[index].show)"></ion-icon>
          <ion-icon slot="end" color="light" name="arrow-down" mode="ios" (click)="isShowGuidance(section,index)"
            *ngIf="list[index].show">
          </ion-icon>
        </ion-item>
        
        <div *ngIf="list[index].show" class="guidance-box">

          <div *ngIf="section.enableSecInfo=='ka_Yes'">
            <ion-item lines="none">
              <ion-icon name="information-circle-outline" color="success"></ion-icon>
              <ion-label (click)="openGuidance(section.secInfoLabel,section.secInfo)">{{section.secInfoLabel}}&nbsp;&nbsp;&nbsp;&nbsp;</ion-label>
            </ion-item>
 
          </div>

          <div *ngIf="section.secId!='AuditTrail' && section.secId!='subform' && section.sectionType!='1' ">
          <div *ngFor="let field of section.fields;let index = index;" class="fieldshow">
            <!--multiselectfield-->
            <div *ngIf="field.xtype==='multiselect'" [hidden]="field.hide">
              <ion-item lines="none">
                <ion-label color="basic" stacked>
                  {{field.label}}
                  <span *ngIf="field.mandatory=='Y'" class="needfill">*</span>
                </ion-label>
              </ion-item>
              <ion-item>
                <ion-select [(ngModel)]='field.value' multiple="true" name="field.name" [ngStyle]="{'color':cbgcolor}" [placeholder]="field.placeholder?field.placeholder:''"
                (ionChange)="getSublistOption(field,section.secId,'change')">
                  <ion-select-option *ngFor="let option of field.options">{{option.text}}</ion-select-option>
                </ion-select>
              </ion-item>
            </div>
            <!--textareafield-->
            <div *ngIf="field.xtype==='textarea'" [hidden]="field.hide">
              <ion-item>
                <div class="divTextarea">
                  <div>
                    <ion-label color="basic" stacked>
                      {{field.label}}
                      <span *ngIf="field.mandatory=='Y'" class="needfill">*</span>
                    </ion-label>
                  </div>
                  <div> <ion-textarea rows="4" [(ngModel)]='field.value' style="background-color:#fff;opacity:0.7;" [ngStyle]="{'color':cbgcolor}" [placeholder]="field.placeholder?field.placeholder:''"></ion-textarea></div>
                </div>
              </ion-item>
            </div>
            <!--multiou-->
            <div *ngIf="field.xtype==='multiou'" [hidden]="field.hide">
              <ion-item>
                <ion-label color="basic" stacked>
                  {{field.label}}
                  <span *ngIf="field.mandatory=='Y'" class="needfill">*</span>
                </ion-label>
              </ion-item>
              <ion-item>
                <ion-select [(ngModel)]='field.value' multiple="" name="field.name" [ngStyle]="{'color':cbgcolor}" [placeholder]="field.placeholder?field.placeholder:''"
                  (ionChange)=getOUSublistdetails(field.name,field.value,section.secId)>
                  <ion-select-option *ngFor="let option of getOuList(field.name,section.secId)" [value]="option.value">
                    {{option.text}}</ion-select-option>
                </ion-select>
              </ion-item>
            </div>
            <!--singleou-->
            <div *ngIf="field.xtype==='singleou'" [hidden]="field.hide">
              <ion-item>
                <ion-label color="basic" stacked>
                  {{field.label}}
                  <span *ngIf="field.mandatory=='Y'" class="needfill">*</span>
                </ion-label>
              </ion-item>
              <ion-item>
                <ion-select  [(ngModel)]='field.value' multiple="false"  [interfaceOptions]="customPopoverOptions" interface="popover" name="field.name" [ngStyle]="{'color':cbgcolor}"
                  (ionChange)=getOUSublistdetails(field.name,field.value,section.secId)>
                  <ion-select-option *ngFor="let option of getOuList(field.name,section.secId)" [value]="option.value">
                    {{option.text}}</ion-select-option>
                </ion-select>
              </ion-item>
            </div>
            <!--date-->
            <div *ngIf="field.xtype=='date'" [hidden]="field.hide">
              <ion-item lines="none">
                <ion-label>
                  {{field.label}}
                  <span *ngIf="field.mandatory=='Y'" class="needfill">*</span>
                </ion-label>
              </ion-item>
              <ion-item>
                <div *ngIf="field.daterange=='all'">
                  <ion-datetime displayFormat="DD/MM/YYYY" [max]="maxYear" [(ngModel)]='field.value'
                  [placeholder]="field.placeholder?field.placeholder:''" color="favorite" [ngStyle]="{'color':cbgcolor,'opacity':field.value?1:0.4}"></ion-datetime>
                </div>
                <div *ngIf="field.daterange=='future'">
                  <ion-datetime displayFormat="DD/MM/YYYY" [min]="curDate" [max]="maxYear" [(ngModel)]='field.value'
                  [placeholder]="field.placeholder?field.placeholder:''" color="favorite" [ngStyle]="{'color':cbgcolor,'opacity':field.value?1:0.4}"></ion-datetime>
                </div>
                <div *ngIf="field.daterange=='past'">
                  <ion-datetime displayFormat="DD/MM/YYYY" [max]="curDate" [(ngModel)]='field.value'
                  [placeholder]="field.placeholder?field.placeholder:''" color="favorite" [ngStyle]="{'color':cbgcolor,'opacity':field.value?1:0.4}"></ion-datetime>
                </div>
                <ion-icon slot="end" name="calendar" mode="md"></ion-icon>
              </ion-item>
            </div>
            <!--singleempselect-->
            <div *ngIf="field.xtype=='singleempselect'" [hidden]="field.hide">
              <ion-item>
                <ion-label>
                  {{field.label}}
                  <span *ngIf="field.mandatory=='Y'" class="needfill">*</span>
                </ion-label>
              </ion-item>
              <ion-item>
                <ion-icon slot="end" name="arrow-forward" mode="ios" (click)="getSecurity(field,'single')"></ion-icon>
                <ion-text [ngStyle]="{'color': cbgcolor}">
                  <h6> {{field.value}}</h6>
                </ion-text>
              </ion-item>
            </div>
            <!--multiempselect-->
            <div *ngIf="field.xtype=='multiempselect'">
              <ion-item>
                <ion-label>
                  {{field.label}}
                  <span *ngIf="field.mandatory=='Y'" class="needfill">*</span>
                </ion-label>
                </ion-item>
                <ion-item>
                <ion-icon slot="end" name="arrow-forward" mode="ios" (click)="getSecurity(field,'multi')"></ion-icon>
                <ion-text [ngStyle]="{'color': cbgcolor}">
                  <h6> {{field.value}}</h6>
                </ion-text>
              </ion-item>
            </div>
            <!--preurl-->
            <div *ngIf="field.xtype=='pre_url'">
              <ion-item>
                <ion-label>
                  {{field.label}}
                  <span *ngIf="field.mandatory=='Y'" class="needfill">*</span>
                </ion-label>
                </ion-item>
                
              <ion-item>
                <ion-label [ngStyle]="{'color': cbgcolor}" (click)="openUrl(field)"> {{field.buttonText}} </ion-label>
               <ion-icon name="link" slot="start" [ngStyle]="{'color': cbgcolor}"></ion-icon>
              </ion-item>
            </div>
            <!--riskmatrix-->
            <!-- <div *ngIf="field.xtype=='riskmatrix'">
              <ion-item>
                <ion-label position="stacked">
                  {{field.label}}
                  <span *ngIf="field.mandatory=='Y'" class="needfill">*</span>
                </ion-label>
                <ion-icon slot="end" name="arrow-forward" mode="ios" (click)="getemplistData()"></ion-icon>
                <ion-text  [color]="txtfontcolor">
                  <h6> {{field.value}}</h6>
                </ion-text>
              </ion-item>
            </div> -->
            <div *ngIf="field.xtype==='riskmatrix'">
              <ion-label style="margin-bottom:10px; " color="basic" stacked>{{field.label}}</ion-label>
              <button style="padding-left:10px;font-size:18px;" ion-item block color="secondary" (click)="getRiskmatrix(field.RiskMatrix,field.name,field.value)">Click to open risk matrix.</button>
               <!-- <a [routerLink]="['/risk-matrix']" [queryParams]="{riskMatrixFrameData:tobj,riskMatrixSaveData:field.value,riskName:field.name}">Risk Matrix</a> -->
               <ion-item *ngIf="field.value" [ngStyle]="{ 'background-color': field.value.ResultColor,'padding-left':'10px' }">
                  {{field.value.TheScore}}
               </ion-item>
            </div>
            <!--richtext-->
            <div *ngIf="field.xtype=='richtext'">
              <ion-item>
                <ion-label position="stacked">
                  {{field.label}}
                  <span *ngIf="field.mandatory=='Y'" class="needfill">*</span>
                </ion-label>
              </ion-item>
              <ion-item>
                <ion-icon slot="end" name="arrow-forward" mode="ios" (click)="getemplistData()"></ion-icon>
                <ion-text [ngStyle]="{'color': cbgcolor}">
                  <h6> {{field.value}}</h6>
                </ion-text>
              </ion-item>
            </div>
            <!--time-->
            <div *ngIf="field.xtype==='time'" [hidden]="field.hide">

              <ion-item lines="none">
                <ion-label color="basic" stacked>{{field.label}}
                  <span *ngIf="field.mandatory=='Y'" class="needfill">*</span>
                </ion-label>
              </ion-item>
              <ion-item style="background-color:#eee;">
                <ion-datetime displayFormat="hh:mm A" pickerFormat="h:mm A" [(ngModel)]='field.value' [placeholder]="field.placeholder?field.placeholder:''" [ngStyle]="{'color':cbgcolor,'opacity':field.value?1:0.4}">
                </ion-datetime>
              </ion-item>
            </div>
            <!--questionnaire quesType='multiple'-->
            <div *ngIf="field.xtype==='questionnaire' && field.quesType==='multiselect' " [hidden]="field.hide">
              <ion-item>
                <ion-label style="margin-bottom:10px; " color="basic" stacked>
                  {{field.label}}
                  <span *ngIf="field.mandatory=='Y'" class="needfill">*</span>
                </ion-label>
              </ion-item>
              <ion-item>
                <ion-select [(ngModel)]='field.value' interface="popover" multiple="true" [placeholder]="field.placeholder?field.placeholder:''" [ngStyle]="{'color':cbgcolor}"
                  (ionChange)="change(field)">
                  <ion-select-option *ngFor="let option of field.options">{{option.text}}</ion-select-option>
                </ion-select>
              </ion-item>
            </div>
            <!--questionnaire quesType='single'-->
            <div *ngIf="field.xtype==='questionnaire' && field.quesType==='singleselect' " [hidden]="field.hide">
              <ion-item>
                <ion-label style="margin-bottom:10px; " color="basic" stacked>
                  {{field.label}}
                  <span *ngIf="field.mandatory=='Y'" class="needfill">*</span>
                </ion-label>
              </ion-item>
              <ion-item>
                <ion-select [(ngModel)]='field.value' interface="popover" [placeholder]="field.placeholder?field.placeholder:''" [ngStyle]="{'color':cbgcolor}"
                  (ionChange)="change(field)">
                  <ion-select-option *ngFor="let option of field.options">{{option.text}}</ion-select-option>
                </ion-select>
              </ion-item>
            </div>
            <!--signature-->
            <div *ngIf="field.xtype==='signature'" [hidden]="field.hide">
              <ion-item>
              <ion-label style="margin-bottom:10px; " color="basic" stacked>
                {{field.label}}
                <span *ngIf="field.mandatory=='Y'" class="needfill">*</span>
              </ion-label>
            </ion-item>
              <ion-input style="display:none;" [(ngModel)]='field.value'></ion-input>
              <div *ngIf="!field.value" class="signature-area">
                <button ion-button clear (click)="signaturePanel(field.name)">Sign Here</button>
              </div>
              <div *ngIf="field.value">
                <ion-item (click)="signaturePanel(field.name)">
                  <img [src]="field.value" />
                </ion-item>
              </div>
            </div>
            <!--attachment-->
            <div *ngIf="field.xtype==='attachment'" [hidden]="field.hide">
              <ion-item>
              <ion-label position="stacked" style="margin-bottom:10px; " color="basic" stacked>
                {{field.label}}
                <span *ngIf="field.mandatory=='Y'" class="needfill">*</span>
              </ion-label>
            <!-- </ion-item>
            <ion-item> -->
              <div *ngIf="!field.value || field.value.length==0" class="signature-area">
                <img src="../../../../assets/icon/attachment/camera.png" (click)="takePicture(field.name,field)" alt="">
                <!-- <button ion-button clear (click)="takePicture(field.name,field)" >Take a Picture</button> -->
              </div>
              <div *ngIf="field.value" class="image-attach">
                <!-- <img [src]="field.value" /> -->
                  <div *ngFor="let att of field.value"  (click)="takePicture(field.name,field,att)">
                    <div *ngIf="att.type==='image'">
                      <img [src]="att.value" />
                      {{cameraTips}}
                    </div>
                    <div *ngIf="att.type!=='image'">
                      <ion-text [ngStyle]="{'color': cbgcolor}">
                        {{att.value}}
                      </ion-text>
                    </div>
                    
                  </div>
                  
              </div>
              <canvas #latlon style="display:none"></canvas>
              <img src="{{field.src}}" alt="" style="display:none">
            </ion-item>
            </div>
            <!--headline-->
            <div *ngIf="field.xtype==='headline'" [hidden]="field.hide" class="column-count"
              [ngStyle]="{'background-color': field.labelBgColor}">
              <h4
                [ngStyle]="{'font-family': field.labelFont,'font-size': field.labelSize, 'color': field.labelColor, 'font-style': field.labelFontStyle,'text-decoration':field.labelTextDecoration}">
                {{field.label}}
              </h4>
              <!--[ngStyle]="{'font-family': field.labelFont,'font-size': field.labelSize, 'color': field.labelColor, 'font-style': field.labelStyle }" -->
            </div>
            <!--computed-->
            <div *ngIf="field.xtype==='computed'" [hidden]="field.hide" class="column-count">
              <h4>{{field.label}}</h4>
            </div>
            <!--gps location-->
            <div *ngIf="field.xtype==='gps_dd'" class="text-number" [hidden]="field.hide">
              <ion-item>
                <ion-label style="margin-bottom:10px; " color="basic" stacked>
                  {{field.label}}
                  <span *ngIf="field.mandatory=='Y'" class="needfill">*</span>
                </ion-label>
              </ion-item>
              <ion-item>
                {{field.value}}
              </ion-item>
            </div>
            <!--textfield-->
            <div *ngIf="field.xtype==='text' || field.xtype==='url'" class="text-number" [hidden]="field.hide">
              <ion-item>
                <ion-label style="margin-bottom:10px; " color="basic" stacked>
                  {{field.label}}
                  <span *ngIf="field.mandatory=='Y'" class="needfill">*</span>
                </ion-label>
              </ion-item>
              <ion-item>
                <ion-input type="text" style="background-color:#fff;opacity:0.7;" [ngStyle]="{'color':cbgcolor}" [(ngModel)]='field.value'
                [placeholder]="field.placeholder?field.placeholder:''"></ion-input>
              </ion-item>
            </div>
            <!--numberfield-->
            <div *ngIf="field.xtype==='number'" class="text-number" [hidden]="field.hide">
              <ion-item>
                <ion-label style="margin-bottom:10px; " color="basic" stacked>
                  {{field.label}}
                  <span *ngIf="field.mandatory=='Y'" class="needfill">*</span>
                </ion-label>
              </ion-item>
              <ion-item>
                <ion-input type="number" style="background-color:#fff;opacity:0.7;" [ngStyle]="{'color':cbgcolor}" [(ngModel)]='field.value'
                [placeholder]="field.placeholder?field.placeholder:''"></ion-input>
              </ion-item>
            </div>
            <!--checkboxfield-->
            <div *ngIf="field.xtype==='checkbox'" [hidden]="field.hide">
              <ion-item style="margin-left:0px;padding-left:0px;padding-right:0px;">
                <ion-label style="margin-bottom:10px; " color="basic" stacked>
                  {{field.label}}
                  <span *ngIf="field.mandatory=='Y'" class="needfill">*</span>
                </ion-label>
                </ion-item>
              <ion-item>
                <div *ngIf="field.options.length>3">
                  <ion-select [(ngModel)]='field.value' multiple="true"
                  (ionChange)=getSublistdetails(field.name,field.value)>
                  <ion-item-option *ngFor="let option of field.options">{{option.text}}</ion-item-option>
                  </ion-select>
                </div>
                <div *ngIf="field.options.length<4">
                  <ion-list>
                    <ion-item *ngFor="let option of field.options">
                      <ion-label>{{option.text}}</ion-label>
                      <ion-checkbox slot="end" [(ngModel)]="option.ischeck" (ionChange)='getCheckValue(option,field)'>
                      </ion-checkbox>
                    </ion-item>
                  </ion-list>
                </div>

                
              </ion-item>
            </div>
            <!--radiofield-->
            <div *ngIf="field.xtype==='radio'" [hidden]="field.hide">
              <ion-item style="margin-left:0px;padding-left:0px;padding-right:0px;">
                <div>
                  <div class="row row-wrap item-calm">
                    <ion-label style="margin-bottom:10px; " color="basic" stacked>
                      {{field.label}}
                      <span *ngIf="field.mandatory=='Y'" class="needfill">*</span>
                    </ion-label>
                  </div>
                  <ion-list  >
                    <ion-radio-group [value]="field.value" >
                      <ion-item *ngFor="let option of field.options">
                        <ion-label>{{option.text}}</ion-label>
                        <ion-radio slot="start" value="{{option.text}}" (click)="radioChange(field,option.text,section.title)"></ion-radio>
                        <!-- <ion-radio *ngIf="field.value==option.text" checked="true" slot="start" value="{{option.text}}" (click)="radioChange(field,option.text,section.title)"></ion-radio>
                        <ion-radio *ngIf="field.value!=option.text"  slot="start" value="{{option.text}}" (click)="radioChange(field,option.text,section.title)"></ion-radio> -->
                      </ion-item>
                    </ion-radio-group>
                   
                  </ion-list>

                </div>

              </ion-item>

            </div>
            <!--selectfield-->
            <div *ngIf="field.xtype=='select'" [hidden]="field.hide">
              <ion-item style="margin-left:0px;padding-left:0px;padding-right:0px;">
                <ion-label style="margin-bottom:10px; " color="basic" stacked>
                  {{field.label}}
                  <span *ngIf="field.mandatory=='Y'" class="needfill">*</span>
                </ion-label>
              </ion-item>
              <ion-item style="margin-left:0px;padding-left:0px;padding-right:0px;">
                <ion-select [(ngModel)]='field.value'
                [interfaceOptions]="customPopoverOptions" interface="popover" [ngStyle]="{'color':cbgcolor}"
                (ionChange)="getSublistOption(field,section.secId,'change')" [placeholder]="field.placeholder?field.placeholder:''">
                <ion-select-option *ngFor="let option of getSelectOption(field,section.secId)">{{option.text}}</ion-select-option>
                <div *ngIf="field.name==sublistObjId">
                  <ion-select-option *ngFor="let option of sublistFiledOptions">{{option.text}}</ion-select-option>
                </div>
              </ion-select>
         
               
                  <!-- <ion-radio-group  *ngIf="getSelectOption(field,section.secId).length < 4"  class="groupRadio3" (ionChange)="getSublistOption(field,section.secId)">
                    <ion-item *ngFor="let option of getSelectOption(field,section.secId)">
                      <ion-label>{{option.text}}</ion-label>
                      <ion-radio *ngIf="field.value==option.text" checked  slot="start" value="{{option.text}}" (click)="selectScore(field,option.text,section.title)"></ion-radio>
                      <ion-radio *ngIf="field.value!=option.text"   slot="start" value="{{option.text}}" (click)="selectScore(field,option.text,section.title)" ></ion-radio>
                    </ion-item>
                  </ion-radio-group> -->
                
                
              </ion-item>
            </div>
          </div>
        </div>
        <div *ngIf="section.secId=='subform'">
          <ion-item lines="none">
            <div>
              <ion-label color="basic" stacked>
                Ref No.
              </ion-label>

            </div>

          </ion-item>
          <div *ngFor="let sdoc of section.sdocs;let index = index;" class="fieldshow">
            <ion-item lines="none">
              <div>
                <ion-text [ngStyle]="{'color': cbgcolor}">
                  <a [routerLink]="['/new-form']"  [ngStyle]="{'color':cbgcolor}"
                    [queryParams]="{unid:sdoc.sunid,aid:sdoc.formid,title:sdoc.refNo,stat:sdoc.WFStatus,type:'open',cururl:ulrs.url}">{{sdoc.refNo}}</a>
                </ion-text>
              </div>

            </ion-item>
          </div>
        </div>
        <div *ngIf="section.secId=='AuditTrail'">
          <ion-item lines="none">
            <div>
              <ion-text [ngStyle]="{'color': cbgcolor}">
                <span [innerHTML]="section.secInfoContent"></span>
              </ion-text>

            </div>

          </ion-item>
        </div>
        <div *ngIf="section.sectionType=='1' && !section.dynamicData">
          <ion-item *ngIf="offlineFlag && getMicrodbData(section.secId).length == 0" >{{online.micTip}}</ion-item>
          <ion-item lines="none" *ngIf="offlineFlag && getMicrodbData(section.secId).length > 0 || !offlineFlag">
            <div *ngIf="!formID">
              <ion-label [ngStyle]="{'color': cbgcolor}" stacked>
                Please save the document to add Field Table sections.
              </ion-label>
            </div>
            <div *ngIf="formID && type!='open'">
              <ion-button #testdom (click)="newMicrodb(null, section)">Add</ion-button>
            </div>

          </ion-item>
            <ion-grid *ngIf="offlineFlag && getMicrodbData(section.secId).length > 0 || !offlineFlag">
              <ion-row>
                <ion-col class="fieldshow" *ngIf="section.enableHideRemoveButton !='ka_Yes'" size="2">
                  <ion-item>
                    
                  </ion-item>
                </ion-col>
                  <ion-col class="fieldshow">
                    <ion-item>
                      {{section.dispFields[0].label}} 
                      <span *ngIf="section.IsMircroSort=='ka_Yes' && section.sortFieldName == section.dispFields[0].id">
                        <img [src]="orderbyImg" alt="" (click)="microsort(section)">
                      </span>
                    </ion-item>
                  </ion-col>
                  <ion-col *ngIf="section.dispFields[1]" size="3">
                    <ion-item style="margin-left: -30px;">
                      {{section.dispFields[1].label}} 
                      <span *ngIf="section.IsMircroSort=='ka_Yes' && section.sortFieldName == section.dispFields[1].id">
                        <img [src]="orderbyImg" alt="" (click)="microsort(section)">
                      </span>
                    </ion-item>
                  </ion-col>
                  <ion-col *ngIf="section.dispFields[2]" size="3">
                    <ion-item  style="margin:0 -20px">
                      {{section.dispFields[2].label}} 
                      <span *ngIf="section.IsMircroSort=='ka_Yes' && section.sortFieldName == section.dispFields[2].id">
                        <img [src]="orderbyImg" alt="" (click)="microsort(section)">
                      </span>
                    </ion-item>
                  </ion-col>
                  
              </ion-row>
                <ion-row *ngFor="let mdoc of getMicrodbData(section.secId);let index = index;" class="fieldshow">
                  <ion-col *ngIf="section.enableHideRemoveButton !='ka_Yes'" size="2">
                    <ion-item>
                      
                      <ion-icon name="trash-outline" (click)="removeMicroDoc(mdoc.unid,section.secId)"></ion-icon>
                    </ion-item>
                  </ion-col>
                  <ion-col class="fieldshow">
                    <ion-item style="margin-left:-20px;">
                      <a (click)="newMicrodb(mdoc.unid,section)"  [ngStyle]="{'color':cbgcolor}">{{mdoc.firstcolval}} </a>
                    </ion-item>
                  </ion-col>
                  <ion-col *ngIf="section.dispFields[1]" size="3">
                    <ion-item style="margin-left:-30px;margin-right: -20px;;">
                      <a (click)="newMicrodb(mdoc.unid,section)"  [ngStyle]="{'color':cbgcolor}">{{mdoc['secondcolval']}}  </a>
                    </ion-item>
                  </ion-col>
                  <ion-col *ngIf="section.dispFields[2]" size="3">
                    <ion-item>
                      <a (click)="newMicrodb(mdoc.unid,section)"  [ngStyle]="{'color':cbgcolor}">{{mdoc['thirdcolval']}}  </a>
                    </ion-item>
                  </ion-col>
                </ion-row>
            </ion-grid>
            
          
        </div>
        <div *ngIf="section.sectionType=='1' && section.dynamicData">
          <app-dynamicsec *ngIf="section.dynamicData.quesList.length>0" [sec]="section" doctype="edit" [unid]="draftDocName?draftDocName:formID" (outer)="saveDynamicData($event,section)"></app-dynamicsec>
          <ion-item *ngIf="section.dynamicData.quesList.length==0">no question</ion-item>
        </div>
        <div *ngIf="section.secId=='myAct'">
          <ion-grid>
            <ion-row>
              <ion-col size="4">
                <ion-item>
                  Due Date
                </ion-item>
              </ion-col>
              <ion-col size="4">
                <ion-item style="margin-right:-20px">
                  Assignee
                </ion-item>
              </ion-col>
              <ion-col size="4">
                <ion-item style="margin-right:-20px">
                  Status
                </ion-item>
              </ion-col>
            </ion-row>

            <ion-row *ngFor="let ass of newActSec.actDataList;">
              <ion-col size='4'>
                <ion-item> 
                 <a (click)="openAction(ass.unid)" [ngStyle]="{'color':cbgcolor}">{{ass.DueDate}}</a> 
                </ion-item>
              </ion-col>
              <ion-col size='4'>
                <ion-item> 
                 <a (click)="openAction(ass.unid)" [ngStyle]="{'color':cbgcolor}">{{ass.actAssignee}}</a> 
                </ion-item>
              </ion-col>
              <ion-col size='4'>
                <ion-item> 
                 <a (click)="openAction(ass.unid)" [ngStyle]="{'color':cbgcolor}">{{ass.WFStatus}}</a> 
                </ion-item>
              </ion-col>
            </ion-row>
          </ion-grid>
        </div>
      </div>

    </div>
    </div>
    <div>
      <ion-item lines="none">
        <div>
          <br/>

        </div>

      </ion-item>
      <ion-item lines="none">
        <div>
          <br/>

        </div>

      </ion-item>
    </div>
  </div>

  <div class="form-container" id="open" *ngIf="type=='open'">

    <div *ngFor="let field of sysfields;let index = index;">
      <!--date-->
      <div [hidden]="field.hide"> 
        <ion-item lines="none">
          <ion-label color="basic" stacked>{{field.label}}</ion-label>
        </ion-item>
        <ion-item>
          <ion-text *ngIf="field.name=='Initiator'" [ngStyle]="{'color': cbgcolor}">
            {{field.value?field.value:initiator}}
          </ion-text>
          <ion-text *ngIf="field.name=='formRoleMR'" (click)="getPeopleByRole(field.value)" [ngStyle]="{'color': cbgcolor}">
            {{field.value}}
          </ion-text>
          <ion-icon *ngIf="field.name=='formRoleMR'" (click)="getPeopleByRole(field.value)" slot="end" name="help-circle-outline"></ion-icon>
          <ion-text *ngIf="field.name!='formRoleMR' && field.name!='Initiator'" [ngStyle]="{'color': cbgcolor}">
            {{field.value}}
          </ion-text>
        </ion-item>
      </div>

    </div>


    <div *ngFor="let section of sections;let index = index;" class="field-container" [id]="section.secId">
      <div *ngIf="index>0">
        <ion-item lines="none" #testdom>
          <ion-label color="light">{{section.title}}&nbsp;&nbsp;&nbsp;&nbsp;{{section.score}}</ion-label>
          <ion-icon slot="end" color="light" name="arrow-forward" mode="ios"
            (click)="isShowGuidance(section,index)" *ngIf="!(list&&list[index]&&list[index].show)"></ion-icon>
          <ion-icon slot="end" color="light" name="arrow-down" mode="ios" (click)="isShowGuidance(section,index)"
            *ngIf="list[index].show">
          </ion-icon>
        </ion-item>
        <div *ngIf="list[index].show" class="guidance-box">

          <div *ngIf="section.enableSecInfo=='ka_Yes'">
            <ion-item lines="none">
              <ion-icon name="information-circle-outline" color="success"></ion-icon>
              <ion-label (click)="openGuidance(section.secInfoLabel,section.secInfo)">{{section.secInfoLabel}}&nbsp;&nbsp;&nbsp;&nbsp;</ion-label>
            </ion-item>
 
          </div>
          <div *ngIf="section.secId!='AuditTrail' && section.secId!='subform' && section.sectionType!='1' ">
            <div *ngFor="let field of section.fields;let index = index;" class="fieldshow" [hidden]="field.hide">
              <!--multiselectfield-->
                <ion-item lines="none">
                  <div *ngIf="field.xtype!='riskmatrix'">
                    <!--headline-->
                    <div *ngIf="field.xtype==='headline'" [hidden]="field.hide" class="column-count"
                    [ngStyle]="{'background-color': field.labelBgColor}">
                    <h4
                      [ngStyle]="{'font-family': field.labelFont,'font-size': field.labelSize, 'color': field.labelColor, 'font-style': field.labelFontStyle,'text-decoration':field.labelTextDecoration}">
                      {{field.label}}
                    </h4>
                    <!--[ngStyle]="{'font-family': field.labelFont,'font-size': field.labelSize, 'color': field.labelColor, 'font-style': field.labelStyle }" -->
                  </div>
                  <div *ngIf="field.xtype!=='headline'">
                    <ion-label color="basic" stacked>
                      {{field.label}}
                      <span *ngIf="field.mandatory=='Y'" class="needfill">*</span>
                    </ion-label>
                    <div *ngIf="field.xtype==='attachment'" [hidden]="field.hide">
                      <div *ngFor="let att of field.value">
                        <div *ngIf="att.type==='image'">
                          <img [src]="att.value" />
                        </div>
                        <div *ngIf="att.type!=='image'">
                          <ion-text [ngStyle]="{'color': cbgcolor}">
                            {{att.value}}
                          </ion-text>
                        </div>
                        
                      </div>
                      
                    </div>
                    <div *ngIf="field.xtype!=='attachment'" [hidden]="field.hide">
                      <div *ngIf="field.xtype==='signature'">
                        <div *ngIf="field.value">
                          <img [src]="field.value" />
                        </div>
                      </div>
                      <div *ngIf="field.xtype!=='signature'">
                        <div *ngIf="field.xtype!=='pre_url' && field.xtype!=='url'">
                          <ion-text [ngStyle]="{'color': cbgcolor}">
                            {{field.value}}
                          </ion-text>
                        </div>
                        <!--preurl-->
                        <div *ngIf="field.xtype=='pre_url' || field.xtype=='url'">
                          <ion-item>
                            <ion-label *ngIf="field.xtype=='pre_url'" [ngStyle]="{'color': cbgcolor}" (click)="openUrl(field)"> {{field.buttonText}} </ion-label>
                            <ion-label *ngIf="field.xtype=='url'" [ngStyle]="{'color': cbgcolor}" (click)="openUrl(field)"> {{field.value}} </ion-label>
                            <ion-icon name="link" slot="start" [ngStyle]="{'color': cbgcolor}"></ion-icon>
                          </ion-item>
                        </div>
                        
                      </div>
                    </div>
                  </div>
                  </div>
                  <div *ngIf="field.xtype==='riskmatrix'">
                    <ion-label style="margin-bottom:10px; " color="basic" stacked>{{field.label}}</ion-label>
                    <button style="padding-left:10px;font-size: 18px;" ion-item block color="secondary" (click)="getRiskmatrix(field.RiskMatrix,field.name,field.value)">Click to open risk matrix.</button>
                     <!-- <a [routerLink]="['/risk-matrix']" [queryParams]="{riskMatrixFrameData:tobj,riskMatrixSaveData:field.value,riskName:field.name}">Risk Matrix</a> -->
                     <ion-item *ngIf="field.value" [ngStyle]="{ 'background-color': field.value.ResultColor,'padding-left':'10px' }">
                        {{field.value.TheScore}}
                     </ion-item>
                  </div>
                </ion-item>
            </div>
          </div>
          <div *ngIf="section.secId=='subform'">
            <ion-item lines="none">
              <div>
                <ion-label color="basic" stacked>
                  Ref No.
                </ion-label>
                
              </div>

            </ion-item>
            <div *ngFor="let sdoc of section.sdocs;let index = index;" class="fieldshow">
                <ion-item lines="none">
                  <div>
                    <ion-text [ngStyle]="{'color': cbgcolor}">
                      <a [routerLink]="['/new-form']" [ngStyle]="{'color':cbgcolor}" [queryParams]="{unid:sdoc.sunid,aid:sdoc.formid,title:sdoc.refNo,stat:sdoc.WFStatus,type:'open',cururl:ulrs.url}">{{sdoc.refNo}}</a>
                    </ion-text>
                  </div>
    
                </ion-item>
            </div>
          </div>
          <div *ngIf="section.secId=='AuditTrail'">
            <ion-item lines="none">
              <div>
                <ion-text [ngStyle]="{'color': cbgcolor}">
                  <span [innerHTML]="section.secInfoContent"></span>
                </ion-text>
              </div>

            </ion-item>
          </div>
          <div *ngIf="section.sectionType=='1' &&!section.dynamicData">
            <ion-item *ngIf="offlineFlag && getMicrodbData(section.secId).length == 0" >{{online.micTip}}</ion-item>
            <ion-grid *ngIf="offlineFlag && getMicrodbData(section.secId).length > 0 || !offlineFlag">
              <ion-row>
                <ion-col [size]="section.dispFields[2]?4:(section.dispFields[1]?6:'')" class="fieldshow">
                    <ion-item>
                      {{section.dispFields[0].label}} 
                      <span *ngIf="section.IsMircroSort=='ka_Yes' && section.sortFieldName == section.dispFields[0].id">
                        <img [src]="orderbyImg" alt="" (click)="microsort(section)">
                      </span>
                    </ion-item>
                  </ion-col>
                  <ion-col size="4" *ngIf="section.dispFields[1]">
                    <ion-item style="margin-right:-20px">
                      {{section.dispFields[1].label}} 
                      <span *ngIf="section.IsMircroSort=='ka_Yes' && section.sortFieldName == section.dispFields[1].id">
                        <img [src]="orderbyImg" alt="" (click)="microsort(section)">
                      </span>
                    </ion-item>
                  </ion-col>
                  <ion-col size="4" *ngIf="section.dispFields[2]">
                    <ion-item style="margin-right:-20px">
                      {{section.dispFields[2].label}} 
                      <span *ngIf="section.IsMircroSort=='ka_Yes' && section.sortFieldName == section.dispFields[2].id">
                        <img [src]="orderbyImg" alt="" (click)="microsort(section)">
                      </span>
                    </ion-item>
                  </ion-col>
              </ion-row>
                <ion-row *ngFor="let mdoc of getMicrodbData(section.secId);let index = index;" class="fieldshow">
                  <ion-col [size]="section.dispFields[2]?4:(section.dispFields[1]?6:'')" class="fieldshow">
                    <ion-item style="margin-left: -10px;">
                      <a (click)="newMicrodb(mdoc.unid,section)"  [ngStyle]="{'color':cbgcolor}">{{mdoc.firstcolval}} </a>
                    </ion-item>
                  </ion-col>
                  <ion-col *ngIf="section.dispFields[1]">
                    <ion-item>
                      <a (click)="newMicrodb(mdoc.unid,section)"  [ngStyle]="{'color':cbgcolor}">{{mdoc['secondcolval']}}  </a>
                    </ion-item>
                  </ion-col>
                  <ion-col *ngIf="section.dispFields[2]">
                    <ion-item>
                      <a (click)="newMicrodb(mdoc.unid,section)"  [ngStyle]="{'color':cbgcolor}">{{mdoc['thirdcolval']}}  </a>
                    </ion-item>
                  </ion-col>
                </ion-row>
            </ion-grid>
            
          </div>
          <div *ngIf="section.sectionType=='1' && section.dynamicData">
            <app-dynamicsec *ngIf="section.dynamicData.quesList.length>0" [sec]="section" doctype="open" [unid]="draftDocName?draftDocName:formID"></app-dynamicsec>
            <ion-item *ngIf="section.dynamicData.quesList.length==0">no question</ion-item>
          </div>
          <div *ngIf="section.secId=='myAct'">
            <ion-grid>
              <ion-row>
                <ion-col size="4">
                  <ion-item>
                    Due Date
                  </ion-item>
                </ion-col>
                <ion-col size="4">
                  <ion-item style="margin-right:-20px">
                    Assignee
                  </ion-item>
                </ion-col>
                <ion-col size="4">
                  <ion-item style="margin-right:-20px">
                    Status
                  </ion-item>
                </ion-col>
              </ion-row>
  
              <ion-row *ngFor="let ass of newActSec.actDataList;">
                <ion-col size='4'>
                  <ion-item> 
                   <a (click)="openAction(ass.unid)" [ngStyle]="{'color':cbgcolor}">{{ass.DueDate}}</a> 
                  </ion-item>
                </ion-col>
                <ion-col size='4'>
                  <ion-item> 
                   <a (click)="openAction(ass.unid)" [ngStyle]="{'color':cbgcolor}">{{ass.actAssignee}}</a> 
                  </ion-item>
                </ion-col>
                <ion-col size='4'>
                  <ion-item> 
                   <a (click)="openAction(ass.unid)" [ngStyle]="{'color':cbgcolor}">{{ass.WFStatus}}</a> 
                  </ion-item>
                </ion-col>
              </ion-row>
            </ion-grid>
          </div>
        </div>

      </div>
    </div>
  </div>
</ion-content>
<ion-footer>


</ion-footer>